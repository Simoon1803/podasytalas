{% extends "base/base_admin.html" %}
{% block title %}Solicitudes de Presupuestos{% endblock %}
{% block content %}

<div class="container py-4">
  <h2 class="fw-bold text-success mb-4">
    <i class="bi bi-clipboard-check"></i> Solicitudes de Presupuestos
  </h2>

  {% if budgets %}
  <div class="table-responsive">
    <table class="table table-hover align-middle shadow-sm">
      <thead class="table-success">
        <tr>
          <th>Nombre</th>
          <th>Correo</th>
          <th>Teléfono</th>
          <th>Comuna</th>
          <th>Descripción</th>
          <th>Fecha</th>
          <th>Imagen</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for b in budgets %}
        <tr>
          <td>{{ b.name }}</td>
          <td>{{ b.email }}</td>
          <td>{{ b.phone }}</td>
          <td>{{ b.comuna }}</td>
          <td>{{ b.description|truncatechars:80 }}</td>
          <td>{{ b.created_at|date:"d/m/Y H:i" }}</td>
          <td>
            {% if b.image %}
            <a href="{{ b.image.url }}" target="_blank" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-image"></i>
            </a>
            {% else %}
            <span class="text-muted">-</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'dashboard:budget_delete' b.id %}" class="btn btn-danger btn-sm">
              <i class="bi bi-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-center text-muted mt-4">No hay solicitudes aún.</p>
  {% endif %}
</div>

{% if messages %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
{% for message in messages %}
Swal.fire({
  icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% else %}info{% endif %}",
  title: "{{ message }}",
  timer: 1500,
  showConfirmButton: false
});
{% endfor %}
</script>
{% endif %}

{% endblock %}
