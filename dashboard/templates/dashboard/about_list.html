{% extends 'base/base_admin.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/forms.css' %}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container py-4">

  <!-- 🔹 Título principal -->
  <h2 class="fw-bold text-center text-success mb-5">
    <i class="bi bi-building"></i> Quiénes Somos
  </h2>

  <!-- 🔸 Información general -->
  {% if about %}
  <div class="card border-0 shadow-sm mb-5">
    <div class="card-body">
      <h4 class="fw-bold text-success">{{ about.title }}</h4>
      <p class="mt-3" style="font-size: 1.1rem; text-align: justify;">
        {{ about.content }}
      </p>

      {% if about.image %}
      <div class="text-center mt-4">
        <img src="{{ about.image.url }}" alt="Imagen empresa"
             class="img-fluid rounded shadow-sm border"
             style="max-height: 400px; object-fit: cover;">
      </div>
      {% endif %}

      <div class="text-end mt-4">
        <a href="{% url 'dashboard:about_edit' about.id %}" class="btn btn-success fw-semibold">
          <i class="bi bi-pencil-square"></i> Editar información
        </a>
      </div>
    </div>
  </div>
  {% else %}
  <div class="alert alert-info text-center shadow-sm">
    <p class="mb-2">Aún no se ha registrado información sobre la empresa.</p>
    <a href="{% url 'dashboard:about_add' %}" class="btn btn-success">
      <i class="bi bi-plus-circle"></i> Agregar información
    </a>
  </div>
  {% endif %}

  <!-- 🔸 Galería -->
  <div class="d-flex justify-content-between align-items-center mb-3 mt-5">
    <h4 class="fw-bold text-success mb-0">
      <i class="bi bi-images"></i> Galería de la Empresa
    </h4>
    <a href="{% url 'dashboard:aboutimage_add' %}" class="btn btn-success btn-sm fw-semibold">
      <i class="bi bi-plus-circle"></i> Agregar Imagen
    </a>
  </div>

  {% if about and about.images.all %}
  <div class="row g-4">
    {% for img in about.images.all %}
    <div class="col-md-4 col-sm-6">
      <div class="card border-0 shadow-sm position-relative">
        <img src="{{ img.image.url }}" alt="{{ img.caption }}"
             class="img-fluid rounded" style="height: 230px; object-fit: cover;">

        <!-- Botón eliminar -->
        <div class="position-absolute top-0 end-0 m-2">
          <button onclick="confirmDelete('{{ img.id }}')" class="btn btn-danger btn-sm">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-muted mt-3">Aún no hay imágenes agregadas.</p>
  {% endif %}

  <!-- 🔸 Equipo -->
  <div class="d-flex justify-content-between align-items-center mt-5 mb-3">
    <h4 class="fw-bold text-success mb-0">
      <i class="bi bi-people"></i> Equipo de Trabajo
    </h4>
    <a href="{% url 'dashboard:team_add' %}" class="btn btn-success btn-sm fw-semibold">
      <i class="bi bi-person-plus"></i> Agregar Miembro
    </a>
  </div>

  {% if about and about.team_members.all %}
  <div class="row g-4">
    {% for member in about.team_members.all %}
    <div class="col-md-4 col-sm-6">
      <div class="card shadow-sm border-0 text-center h-100">
        <img src="{{ member.photo.url }}" alt="{{ member.name }}"
             class="img-fluid rounded-top" style="height: 260px; object-fit: cover;">
        <div class="card-body">
          <h5 class="fw-bold text-dark">{{ member.name }}</h5>
          <p class="text-muted mb-2">{{ member.role }}</p>
          <div class="d-flex justify-content-center gap-2">
            <a href="{% url 'dashboard:team_edit' member.id %}" class="btn btn-primary btn-sm">
              <i class="bi bi-pencil-square"></i>
            </a>
            <button onclick="confirmDeleteMember('{{ member.id }}')" class="btn btn-danger btn-sm">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-center text-muted">Aún no se han agregado miembros del equipo.</p>
  {% endif %}
</div>

<!-- 🔸 SweetAlert scripts -->
<script>
function confirmDelete(id) {
  Swal.fire({
    title: "¿Eliminar imagen?",
    text: "Esta acción no se puede deshacer.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#2e7d32",
    cancelButtonColor: "#d33",
    confirmButtonText: "Sí, eliminar",
    cancelButtonText: "Cancelar"
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `/dashboard/about/image/delete/${id}/`;
    }
  });
}

function confirmDeleteMember(id) {
  Swal.fire({
    title: "¿Eliminar miembro?",
    text: "Esta acción eliminará permanentemente al integrante.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#2e7d32",
    cancelButtonColor: "#d33",
    confirmButtonText: "Sí, eliminar",
    cancelButtonText: "Cancelar"
  }).then((result) => {
    if (result.isConfirmed) {
      window.location.href = `/dashboard/team/delete/${id}/`;
    }
  });
}
</script>
{% endblock %}
