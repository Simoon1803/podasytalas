{% extends "base/base.html" %}
{% load static %}

{% block title %}Inicio ‚Äî Podas y Talas Isa√≠as{% endblock %}

{% block content %}

<!-- üåø SECCI√ìN HERO CON VIDEO -->
<section class="hero-section position-relative">
  <video autoplay muted loop playsinline class="hero-video">
    <source src="{% static 'videos/1000419971.mp4' %}" type="video/mp4">
    Tu navegador no soporta el video.
  </video>

  <div class="hero-overlay d-flex flex-column justify-content-center align-items-center text-center text-white px-3">
    <h1 class="fw-bold display-5 mb-3 animate__animated animate__fadeInDown" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.6);">
      Expertos en podas, talas y mantenimiento de √°reas verdes<br>
      con calidad y seguridad garantizada.
    </h1>
    <p class="lead mb-4 animate__animated animate__fadeInUp" style="text-shadow: 1px 1px 6px rgba(0,0,0,0.5);">
      Conf√≠a en profesionales con experiencia. Solicita tu presupuesto aqu√≠ mismo.
    </p>
  </div>
</section>

<!-- üßæ FORMULARIO DE PRESUPUESTO -->
<section id="presupuesto" class="py-5 bg-light">
  <div class="container">
    <h2 class="fw-bold text-success text-center mb-4" data-aos="fade-up">
      <i class="bi bi-clipboard-check"></i> Solicita tu Presupuesto
    </h2>

    <div class="card shadow p-4 mx-auto" style="max-width: 700px; border-radius: 20px;" data-aos="fade-up" data-aos-delay="100">
      <form method="POST" enctype="multipart/form-data" id="budgetForm">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold"><i class="bi bi-person"></i> Nombre completo</label>
            {{ form.name }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold"><i class="bi bi-envelope"></i> Correo electr√≥nico</label>
            {{ form.email }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold"><i class="bi bi-telephone"></i> Tel√©fono</label>
            {{ form.phone }}
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold"><i class="bi bi-geo-alt"></i> Comuna</label>
            {{ form.comuna }}
          </div>
          <div class="col-12">
            <label class="form-label fw-semibold"><i class="bi bi-chat-left-text"></i> Descripci√≥n</label>
            {{ form.description }}
          </div>
          <div class="col-12">
            <label class="form-label fw-semibold"><i class="bi bi-image"></i> Subir imagen (opcional)</label>
            {{ form.image }}
          </div>
          <div class="text-end mt-3">
            <button type="button" id="confirmButton" class="btn btn-success btn-lg px-4 shadow-sm rounded-4">
              <i class="bi bi-send"></i> Enviar Solicitud
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- üå≥ SERVICIOS DESTACADOS -->
<section id="servicios" class="py-5 bg-white position-relative">
  <div class="container">
    <h2 class="fw-bold text-success text-center mb-5" data-aos="fade-up">
      <i class="bi bi-tree"></i> Nuestros Servicios Destacados
    </h2>

    <div class="row g-4 justify-content-center">
      {% for s in services %}
      <div class="col-lg-4 col-md-6" data-aos="zoom-in" data-aos-delay="{{ forloop.counter|add:'1' }}00">
        <div class="service-card-pro h-100 d-flex flex-column shadow-lg rounded-4 border-0">
          {% if s.image %}
          <div class="service-img-wrapper position-relative">
            <img src="{{ s.image.url }}" class="service-img-pro" alt="{{ s.title }}">
            <div class="service-badge"><i class="bi bi-shield-check"></i> Servicio Profesional</div>
          </div>
          {% endif %}
          <div class="p-4 d-flex flex-column flex-grow-1 text-center">
            <h5 class="fw-bold text-success mb-3">{{ s.title }}</h5>
            <p class="text-muted flex-grow-1">{{ s.description|truncatechars:200 }}</p>
            <div class="mt-4">
              <a class="btn btn-outline-success rounded-pill px-4 fw-semibold">VER M√ÅS</a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center text-muted">üå± A√∫n no hay servicios registrados.</div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- üé• VIDEOS -->
<section id="videos" class="py-5 bg-white">
  <div class="container">
    <h2 class="fw-bold text-success text-center mb-5" data-aos="fade-up">
      <i class="bi bi-camera-reels"></i> Videos Destacados
    </h2>
    <div class="row g-4 justify-content-center">
      {% for v in videos %}
      <div class="col-lg-4 col-md-6 col-sm-8" data-aos="zoom-in" data-aos-delay="{{ forloop.counter|add:'1' }}00">
        <div class="video-card-pro shadow-lg rounded-4 overflow-hidden border border-success-subtle">
          <div class="ratio ratio-16x9 video-frame-wrapper">
            {% if v.video_file %}
              <video controls class="w-100 h-100" style="object-fit:cover;">
                <source src="{{ v.video_file.url }}" type="video/mp4">
              </video>
            {% elif v.video_url %}
              <iframe src="{{ v.video_url }}" allowfullscreen></iframe>
            {% else %}
              <div class="d-flex align-items-center justify-content-center bg-dark text-white">
                <span class="small text-secondary">Sin video disponible</span>
              </div>
            {% endif %}
          </div>
        </div>
        <p class="fw-semibold text-center mt-3">{{ v.title }}</p>
      </div>
      {% empty %}
      <div class="col-12 text-center text-muted">üé¨ A√∫n no hay videos disponibles.</div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- ‚òï ¬øPOR QU√â ELEGIRNOS? -->
<section class="py-5 choose-us-section">
  <div class="container text-center">
    <h2 class="fw-bold mb-5" data-aos="fade-up" style="font-size:2.3rem; color:#fff;">
      ¬øPor qu√© elegir a <span style="color:#e8c27c;">Podas y Talas Isa√≠as</span>?
    </h2>

    <div class="row g-4 justify-content-center">
      <div class="col-lg-6 col-xl-3" data-aos="zoom-in" data-aos-delay="100">
        <div class="choose-card h-100 shadow-lg">
          <div class="icon-box mb-3"><i class="bi bi-gear-wide-connected"></i></div>
          <h5 class="fw-bold mb-3">Profesionalismo Real</h5>
          <p>M√°s de una d√©cada entregando servicios de excelencia en podas, talas y mantenimiento, con personal especializado y maquinaria de primer nivel.</p>
        </div>
      </div>

      <div class="col-lg-6 col-xl-3" data-aos="zoom-in" data-aos-delay="200">
        <div class="choose-card h-100 shadow-lg">
          <div class="icon-box mb-3"><i class="bi bi-shield-lock"></i></div>
          <h5 class="fw-bold mb-3">Seguridad Garantizada</h5>
          <p>Trabajamos con protocolos certificados y aseguramos el bienestar de tu propiedad y de nuestro equipo en cada proyecto realizado.</p>
        </div>
      </div>

      <div class="col-lg-6 col-xl-3" data-aos="zoom-in" data-aos-delay="300">
        <div class="choose-card h-100 shadow-lg">
          <div class="icon-box mb-3"><i class="bi bi-hourglass-split"></i></div>
          <h5 class="fw-bold mb-3">Compromiso y Puntualidad</h5>
          <p>Cumplimos con cada cliente en tiempo y forma, ofreciendo resultados confiables, transparentes y de alta calidad.</p>
        </div>
      </div>

      <div class="col-lg-6 col-xl-3" data-aos="zoom-in" data-aos-delay="400">
        <div class="choose-card h-100 shadow-lg">
          <div class="icon-box mb-3"><i class="bi bi-flower3"></i></div>
          <h5 class="fw-bold mb-3">Respeto por la Naturaleza</h5>
          <p>Promovemos la sustentabilidad mediante pr√°cticas responsables, reciclando residuos vegetales y cuidando cada √°rbol con respeto y conciencia ecol√≥gica.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚úÖ SWEETALERT Y WHATSAPP -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<div id="alert-data" data-message="{% for m in messages %}{{ m }}{% endfor %}" data-tag="{% for m in messages %}{{ m.tags }}{% endfor %}" style="display:none;"></div>

<script>
document.getElementById("confirmButton").addEventListener("click", function() {
  Swal.fire({
    title: "¬øEnviar solicitud de presupuesto?",
    text: "Verifica que tus datos sean correctos antes de continuar.",
    icon: "question",
    showCancelButton: true,
    confirmButtonColor: "#2e7d32",
    cancelButtonColor: "#d33",
    confirmButtonText: "S√≠, enviar",
    cancelButtonText: "Cancelar"
  }).then((r)=>{ if(r.isConfirmed){ document.getElementById("budgetForm").submit(); }});
});

const box=document.getElementById("alert-data");
if(box.dataset.message && box.dataset.tag==="success"){
  Swal.fire({position:"top-end",icon:"success",title:"Tu solicitud fue enviada con √©xito",showConfirmButton:false,timer:1500,toast:true});
}

// üéØ Recorre todos los botones "VER M√ÅS"
  document.querySelectorAll('.service-card-pro a').forEach((btn, index) => {
    btn.addEventListener('click', () => {
      const serviceCard = btn.closest('.service-card-pro');
      const title = serviceCard.querySelector('h5').textContent.trim();
      const description = serviceCard.querySelector('p').textContent.trim();
      const imgTag = serviceCard.querySelector('img');
      const imageUrl = imgTag ? imgTag.src : defaultLogo;

      Swal.fire({
        title: `<h2 class="fw-bold text-success mb-3">${title}</h2>`,
        html: `
          <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
            <img src="${imageUrl}" alt="${title}" 
                 style="max-width:380px;border-radius:1rem;box-shadow:0 4px 25px rgba(0,0,0,0.2);margin-bottom:15px;">
            <p style="text-align:justify;font-size:1.05rem;color:#333;max-width:90%;">${description}</p>
          </div>
        `,
        confirmButtonText: "Cerrar",
        confirmButtonColor: "#2e7d32",
        background: "#fff",
        backdrop: "rgba(0,0,0,0.6)",
        allowOutsideClick: true,
        allowEscapeKey: true,
        showConfirmButton: true,
        heightAuto: true,
        showClass: { popup: "animate__animated animate__zoomIn animate__faster" },
        hideClass: { popup: "animate__animated animate__fadeOut animate__faster" }
      });
    });
  });
</script>

<a href="https://api.whatsapp.com/send?phone=56927652097&text=Hola%20necesito%20una%20cotizaci%C3%B3n%20de%20podas%20y%20talas" class="whatsapp-float" target="_blank" rel="noopener"><i class="bi bi-whatsapp"></i></a>

<!-- üåà ESTILOS -->
<style>
.hero-section{position:relative;height:95vh;overflow:hidden;}
.hero-video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(1.1) contrast(1.1) saturate(1.3);}
.hero-overlay{position:relative;z-index:2;background:rgba(0,60,25,0.55);width:100%;height:100%;}
input,textarea,select{border-radius:10px!important;border:1.5px solid #cce3d0;padding:10px 12px;width:100%;transition:all .3s ease;}
input:focus,textarea:focus{border-color:#2e7d32;box-shadow:0 0 8px rgba(46,125,50,0.3);}
.service-card-pro{border-radius:1rem;background:#fff;transition:all .3s ease;border:1px solid rgba(0,0,0,0.05);}
.service-card-pro:hover{transform:translateY(-6px);box-shadow:0 16px 35px rgba(0,0,0,0.15);}
.service-img-pro{width:100%;height:220px;object-fit:cover;transition:transform .4s ease;}
.service-card-pro:hover .service-img-pro{transform:scale(1.05);}
.service-badge{position:absolute;top:12px;left:12px;background:rgba(25,135,84,0.9);color:#fff;font-size:.8rem;font-weight:600;padding:.4rem .6rem;border-radius:.5rem;}
.video-card-pro{border-radius:1rem;background:#fff;transition:all .3s ease;}
.video-card-pro:hover{transform:scale(1.03);box-shadow:0 16px 35px rgba(0,0,0,0.15);}
.choose-us-section{background:linear-gradient(180deg,#5a3e2b 0%,#7b5b3d 100%);color:#fff;position:relative;overflow:hidden;padding-top:5rem;padding-bottom:5rem;}
.choose-card{background:rgba(255,255,255,0.08);border-radius:1.5rem;padding:2rem 1.5rem;border:1px solid rgba(255,255,255,0.15);transition:all 0.4s ease;color:#fff;}
.choose-card:hover{background:rgba(255,255,255,0.18);transform:translateY(-8px);box-shadow:0 10px 30px rgba(0,0,0,0.35);}
.choose-card h5{color:#ffecb3;font-weight:700;}
.choose-card p{color:#f3f3f3;font-size:0.97rem;}
.icon-box{font-size:2.8rem;color:#e8c27c;background:rgba(255,255,255,0.1);width:70px;height:70px;margin:0 auto 10px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;}
.choose-card:hover .icon-box{background:rgba(255,255,255,0.25);color:#fff4c3;transform:scale(1.1);}
.whatsapp-float{position:fixed;right:18px;bottom:18px;background-color:#25D366;color:#fff;font-size:28px;width:58px;height:58px;border-radius:50%;box-shadow:0 10px 25px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:9999;transition:all .2s ease;}
.whatsapp-float:hover{transform:scale(1.07);}
@media(max-width:768px){.hero-section{height:80vh}.display-5{font-size:1.8rem}.lead{font-size:1rem}.choose-card{margin-bottom:1rem}}
</style>

{% endblock %}
